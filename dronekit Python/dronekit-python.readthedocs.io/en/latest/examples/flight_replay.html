<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- Mirrored from dronekit-python.readthedocs.io/en/latest/examples/flight_replay.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 14:26:46 GMT -->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	
		<link rel="stylesheet" href="../../../../assets.readthedocs.org/static/css/badge_only.css" type="text/css" />
	
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
	

	<link rel="stylesheet" href="../_static/css/style.css" />
	<script src="../_static/js/modernizr.js"></script>
	<link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700' rel='stylesheet' type='text/css'>

	
		<title>Example: Flight Replay</title>
	

	<script type="text/javascript">
		var DOCUMENTATION_OPTIONS = {
			URL_ROOT: '',
			VERSION: '2.4.0',
			COLLAPSE_INDEX: false,
			FILE_SUFFIX: '.html',
			HAS_SOURCE: true
		};
	</script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="flight_replay.html" />

<link rel="stylesheet" href="../../../../assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "examples/flight_replay"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="../../../../assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>
<body>
	<nav id="topnav" class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button class="navbar-toggle collapsed icon-facebook-sign" type="button" data-toggle="collapse" data-target="#collapsable-topnav">
					<i class="fa fa-bars"></i>
				</button>
				<a class="navbar-brand" href="http://dronekit.io/">
					<img src="../_static/images/new-DK-logo-color.svg" alt="3DR">
				</a>
			</div>
			<div class="navbar-collapse collapse" id="collapsable-topnav">
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="https://cloud.dronekit.io/" class="cloud">Cloud</a>
					</li>
					<li>
						<a href="http://python.dronekit.io/" class="air">Python</a>
					</li>
					<li>
						<a href="http://android.dronekit.io/" class="ground">Android</a>
					</li>
					<li>
						<a href="http://dronekit.io/support" class="support">Support</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row gray-bg">
			<div class="col-sm-3 col-md-2 col-sidebar">

        
					
	<div id="sidebar-search" role="search">
		<form id="rtd-search-form" class="form-inline" action="https://dronekit-python.readthedocs.io/en/latest/search.html" method="get">
			<div class="input-group">
				<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
				<input class="form-control" type="text" name="q" placeholder="Search..." />
			</div>
			<input type="hidden" name="check_keywords" value="yes" />
			<input type="hidden" name="area" value="default" />
		</form>
	</div>
        
				<div id="gray-sidebar" class="container-fluid">
	        
	          
	          
	              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/overview.html">About DroneKit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/overview.html#open-source-community">Open source community</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/overview.html#compatibility">Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/overview.html#api-features">API features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/overview.html#technical-support">Technical support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/release_notes.html">Release Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/release_notes.html#latest-release">Latest release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/release_notes.html#changelog">Changelog</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-9-1-2017-04-21">Version 2.9.1 (2017-04-21)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-9-0-2016-08-29">Version 2.9.0 (2016-08-29)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-8-0-2016-07-15">Version 2.8.0 (2016-07-15)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-7-0-2016-06-21">Version 2.7.0 (2016-06-21)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-6-0-2016-06-17">Version 2.6.0 (2016-06-17)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-5-0-2016-05-04">Version 2.5.0 (2016-05-04)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-4-0-2016-02-29">Version 2.4.0 (2016-02-29)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-3-0-2016-02-26">Version 2.3.0 (2016-02-26)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-2-0-2016-02-19">Version 2.2.0 (2016-02-19)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-1-0-2016-02-16">Version 2.1.0 (2016-02-16)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-0-2-2015-11-30">Version 2.0.2 (2015-11-30)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/release_notes.html#version-2-0-0-2015-11-23">Version 2.0.0 (2015-11-23)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../about/release_notes.html#all-releases">All releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/release_notes.html#working-with-releases">Working with releases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/migrating.html">Migrating to DKPY 2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/migrating.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/migrating.html#launching-scripts">Launching scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/migrating.html#code-changes">Code changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#connecting-to-a-vehicle">Connecting to a vehicle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#connection-status-checks">Connection status checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#script-completion-checks">Script completion checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#command-line-arguments">Command line arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#current-script-directory">Current script directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#vehicle-location">Vehicle.location</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#takeoff-and-movement-commands">Takeoff and movement commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#home-location">Home location</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#missions-and-waypoints">Missions and Waypoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#observing-attribute-changes">Observing attribute changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#parameter-changes">Parameter changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#intercepting-mavlink-messages">Intercepting MAVLink Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#new-attributes">New attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/migrating.html#channel-overrides">Channel Overrides</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../about/migrating.html#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/license.html">Open Source Licence</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guide/quick_start.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guide/quick_start.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide/quick_start.html#basic-hello-drone">Basic “Hello Drone”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide/quick_start.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop/index.html">Developing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../develop/installation.html">Installing DroneKit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../develop/companion-computers.html">Companion Computers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/companion-computers.html#raspberrypi">RaspberryPi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/companion-computers.html#intel-edison">Intel Edison</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/companion-computers.html#beagleboneblack">BeagleBoneBlack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/companion-computers.html#odroid">Odroid</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/sitl_setup.html">Simulated Vehicle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/sitl_setup.html#dronekit-sitl">DroneKit-SITL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/sitl_setup.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/sitl_setup.html#running-sitl">Running SITL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/sitl_setup.html#connecting-to-dronekit-sitl">Connecting to DroneKit-SITL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/sitl_setup.html#dronekit-sitl-python-api">DroneKit-SITL Python API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/sitl_setup.html#building-sitl-from-source">Building SITL from source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/sitl_setup.html#connecting-an-additional-ground-station">Connecting an additional Ground Station</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/best_practice.html">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#general-considerations">General considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#connecting">Connecting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#launch-sequence">Launch sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#movement-commands">Movement commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#vehicle-information">Vehicle information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#missions-and-waypoints">Missions and waypoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#monitor-and-react-to-state-changes">Monitor and react to state changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#sleep-the-script-when-not-needed">Sleep the script when not needed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#exiting-a-script">Exiting a script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#subclass-vehicle">Subclass Vehicle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#debugging">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#launching-scripts">Launching scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/best_practice.html#current-script-directory">Current script directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/coding_standards.html">Coding Standards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guide/connecting_vehicle.html">Connecting to a Vehicle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/connecting_vehicle.html#get-started-connect-string">Connection string options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/connecting_vehicle.html#connecting-to-multiple-vehicles">Connecting to multiple vehicles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html">Vehicle State and Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#attributes">Attributes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#getting-attributes">Getting attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#setting-attributes">Setting attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#observing-attribute-changes">Observing attribute changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#home-location">Home location</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#parameters">Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#getting-parameters">Getting parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#setting-parameters">Setting parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#listing-all-parameters">Listing all parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#observing-parameter-changes">Observing parameter changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/vehicle_state_and_parameters.html#known-issues">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/taking_off.html">Taking Off</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide/copter/guided_mode.html">Guiding and Controlling Copter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/copter/guided_mode.html#controlling-vehicle-movement">Controlling vehicle movement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#position-control">Position control</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#velocity-control">Velocity control</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#acceleration-and-force-control">Acceleration and force control</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/copter/guided_mode.html#guided-mode-commands">Guided mode commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#sending-messages-commands">Sending messages/commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#supported-commands">Supported commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#setting-the-yaw">Setting the Yaw</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#setting-the-roi">Setting the ROI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/copter/guided_mode.html#command-acknowledgements-and-response-values">Command acknowledgements and response values</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/copter/guided_mode.html#frame-conversion-functions">Frame conversion functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/copter/guided_mode.html#other-information">Other information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/auto_mode.html">Missions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#mission-command-overview">Mission Command Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#download-current-mission">Download current mission</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#clearing-current-mission">Clearing current mission</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#creating-adding-mission-commands">Creating/adding mission commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#modifying-missions">Modifying missions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#running-and-monitoring-missions">Running and monitoring missions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#handling-the-end-of-a-mission">Handling the end of a mission</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#useful-mission-functions">Useful Mission functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/auto_mode.html#load-a-mission-from-a-file">Load a mission from a file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/auto_mode.html#save-a-mission-to-a-file">Save a mission to a file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/auto_mode.html#get-distance-to-waypoint">Get distance to waypoint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/auto_mode.html#useful-links">Useful Links</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/debugging.html">Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/debugging.html#pdb-the-python-debugger">pdb - The Python Debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/debugging.html#pudb-a-full-screen-console-based-python-debugger">pudb - A full-screen, console-based Python debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/debugging.html#print-log-statements">Print/log statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/debugging.html#other-ides-debuggers">Other IDEs/debuggers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/mavlink_messages.html">MAVLink Messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/mavlink_messages.html#creating-a-message-listener">Creating a message listener</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/mavlink_messages.html#watching-all-messages">Watching all messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/mavlink_messages.html#removing-an-observer">Removing an observer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="running_examples.html">Running the Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="vehicle_state.html">Vehicle State</a><ul>
<li class="toctree-l3"><a class="reference internal" href="vehicle_state.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="vehicle_state.html#how-does-it-work">How does it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="vehicle_state.html#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="vehicle_state.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="simple_goto.html">Simple Goto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="simple_goto.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="simple_goto.html#how-does-it-work">How does it work?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="simple_goto.html#takeoff">Takeoff</a></li>
<li class="toctree-l4"><a class="reference internal" href="simple_goto.html#flying-to-a-point-simple-goto">Flying to a point - simple_goto</a></li>
<li class="toctree-l4"><a class="reference internal" href="simple_goto.html#rtl-return-to-launch">RTL - Return to launch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="simple_goto.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="guided-set-speed-yaw-demo.html">Guided Movement and Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="guided-set-speed-yaw-demo.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="guided-set-speed-yaw-demo.html#how-does-it-work">How does it work?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="guided-set-speed-yaw-demo.html#goto-convenience-function">goto() - convenience function</a></li>
<li class="toctree-l4"><a class="reference internal" href="guided-set-speed-yaw-demo.html#send-ned-velocity">send_ned_velocity()</a></li>
<li class="toctree-l4"><a class="reference internal" href="guided-set-speed-yaw-demo.html#send-global-velocity">send_global_velocity()</a></li>
<li class="toctree-l4"><a class="reference internal" href="guided-set-speed-yaw-demo.html#goto-position-target-global-int">goto_position_target_global_int()</a></li>
<li class="toctree-l4"><a class="reference internal" href="guided-set-speed-yaw-demo.html#goto-position-target-local-ned">goto_position_target_local_ned()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="guided-set-speed-yaw-demo.html#testbed-settings">Testbed settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="guided-set-speed-yaw-demo.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mission_basic.html">Basic Mission</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mission_basic.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="mission_basic.html#how-does-it-work">How does it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="mission_basic.html#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="mission_basic.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mission_import_export.html">Mission Import/Export</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mission_import_export.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="mission_import_export.html#how-does-it-work">How does it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="mission_import_export.html#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="mission_import_export.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="create_attribute.html">Create Attribute in App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="create_attribute.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_attribute.html#how-does-it-work">How does it work?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="create_attribute.html#subclassing-vehicle">Subclassing Vehicle</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_attribute.html#using-the-vehicle-subclass">Using the Vehicle subclass</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="create_attribute.html#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_attribute.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="follow_me.html">Follow Me (Linux only)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="follow_me.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="follow_me.html#how-does-it-work">How does it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="follow_me.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="drone_delivery.html">Drone Delivery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="drone_delivery.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="drone_delivery.html#screenshots">Screenshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="drone_delivery.html#how-it-works">How it works</a><ul>
<li class="toctree-l4"><a class="reference internal" href="drone_delivery.html#using-attribute-observers">Using attribute observers</a></li>
<li class="toctree-l4"><a class="reference internal" href="drone_delivery.html#starting-cherrypy-from-a-dronekit-application">Starting CherryPy from a DroneKit application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="drone_delivery.html#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="drone_delivery.html#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Flight Replay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How it works</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#getting-the-points">Getting the points</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-the-new-waypoints">Setting the new waypoints</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="channel_overrides.html">Channel Overrides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="channel_overrides.html#running-the-example">Running the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="channel_overrides.html#how-does-it-work">How does it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="channel_overrides.html#source-code">Source code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing/getting_started.html">How you can Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/contributions_api.html">Contributing to the API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing/contributions_api.html#submitting-changes">Submitting changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/contributions_api.html#test-code">Test code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../contributing/contributions_api.html#setting-up-local-testing">Setting up local testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contributing/contributions_api.html#unit-tests">Unit tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contributing/contributions_api.html#integration-tests">Integration tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/contributions_documentation.html">Contributing to the Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing/contributions_documentation.html#documentation-system-overview">Documentation system overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/contributions_documentation.html#submitting-changes">Submitting changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/contributions_documentation.html#building-the-docs">Building the docs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/contributions_documentation.html#style-guide">Style guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/developer_setup_windows.html">Building DroneKit-Python on Windows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing/developer_setup_windows.html#install-dronekit-using-winpython-command-line">Install DroneKit using WinPython command line</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/developer_setup_windows.html#fetch-and-build-dronekit-source">Fetch and build DroneKit source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/developer_setup_windows.html#updating-dronekit">Updating DroneKit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/developer_setup_linux.html">Building DroneKit-Python on Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing/developer_setup_linux.html#fetch-and-build-dronekit-source">Fetch and build DroneKit source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/developer_setup_linux.html#updating-dronekit">Updating DroneKit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../automodule.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference external" href="http://python.dronekit.io/genindex.html">Index</a></li>
</ul>
</li>
</ul>

	          
	        
				</div>
			</div>
			<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
				<div id="api-content">
					
  <div class="section" id="example-flight-replay">
<h1>Example: Flight Replay<a class="headerlink" href="#example-flight-replay" title="Permalink to this headline">¶</a></h1>
<p>This example creates and runs a waypoint mission using position information from a TLOG file.</p>
<p>The log used in this example contains around 2700 points. This is too many points to upload
to the autopilot (and to usefully display). Instead we only add points that are more than
3 metres away from the previously kept point, and only store 99 points in total.
After 60 seconds the mission is ended by setting the mode to RTL (return to launch).</p>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="../_images/flight_replay_example.png"><img alt="../_images/flight_replay_example.png" src="../_images/flight_replay_example.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-text">99 point mission generated from log</span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The method used to reduce the number of points is fairly effective, but we
could do better by grouping some of the waypoints, and mapping others using
spline waypoints. This might be a
<a class="reference external" href="https://github.com/dronekit/dronekit-python/issues/561">fun research project</a>!</p>
</div>
<div class="section" id="running-the-example">
<h2>Running the example<a class="headerlink" href="#running-the-example" title="Permalink to this headline">¶</a></h2>
<p>The example can be run as described in <a class="reference internal" href="running_examples.html"><span class="doc">Running the Examples</span></a> (which in turn assumes that the vehicle
and DroneKit have been set up as described in <a class="reference internal" href="../develop/installation.html#installing-dronekit"><span class="std std-ref">Installing DroneKit</span></a>).</p>
<p>In summary, after cloning the repository:</p>
<ol class="arabic">
<li><p class="first">Navigate to the example folder as shown:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> dronekit-python/examples/flight_replay/
</pre></div>
</div>
</li>
<li><p class="first">You can run the example against a simulator (DroneKit-SITL) by specifying the Python script without any arguments.
The example will download SITL binaries if needed, start the simulator, and then connect to it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python flight_replay.py
</pre></div>
</div>
<p>On the command prompt you should see (something like):</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>Generating waypoints from tlog...
 Generated 100 waypoints from tlog
Starting copter simulator (SITL)
SITL already Downloaded.
Connecting to vehicle on: tcp:127.0.0.1:5760
&gt;&gt;&gt; APM:Copter V3.3 (d6053245)
&gt;&gt;&gt; Frame: QUAD
&gt;&gt;&gt; Calibrating barometer
&gt;&gt;&gt; Initialising APM...
&gt;&gt;&gt; barometer calibration complete
&gt;&gt;&gt; GROUND START
Uploading 100 waypoints to vehicle...
Arm and Takeoff
 Waiting for vehicle to initialise...
&gt;&gt;&gt; flight plan received
 Waiting for arming...
 Waiting for arming...
 Waiting for arming...
 Waiting for arming...
&gt;&gt;&gt; ARMING MOTORS
&gt;&gt;&gt; GROUND START
 Waiting for arming...
&gt;&gt;&gt; Initialising APM...
 Waiting for arming...
&gt;&gt;&gt; ARMING MOTORS
 Taking off!
 Altitude: 0.000000 &lt; 28.500000
 Altitude: 0.010000 &lt; 28.500000
 ...
 Altitude: 26.350000 &lt; 28.500000
 Altitude: 28.320000 &lt; 28.500000
 Reached target altitude of ~30.000000
Starting mission
Distance to waypoint (1): 3.02389745499
&gt;&gt;&gt; Reached Command #1
Distance to waypoint (2): 5.57718471895
Distance to waypoint (2): 4.1504263025
&gt;&gt;&gt; Reached Command #2
Distance to waypoint (3): 0.872847106279
Distance to waypoint (3): 1.88967925144
Distance to waypoint (3): 2.16157704522
&gt;&gt;&gt; Reached Command #3
Distance to waypoint (4): 4.91867197924
...
...
Distance to waypoint (35): 4.37309981133
&gt;&gt;&gt; Reached Command #35
Distance to waypoint (36): 5.61829417257
&gt;&gt;&gt; Reached Command #36
Return to launch
Close vehicle object
Completed...
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It is more interesting to watch the example run on a map than the console. The topic <a class="reference internal" href="../develop/sitl_setup.html#viewing-uav-on-map"><span class="std std-ref">Connecting an additional Ground Station</span></a>
explains how to set up <em>Mission Planner</em> to view a vehicle running on the simulator (SITL).</p>
</div>
</li>
<li><p class="first">You can run the example against a specific connection (simulated or otherwise) by passing the <a class="reference internal" href="../guide/connecting_vehicle.html#get-started-connect-string"><span class="std std-ref">connection string</span></a> for your vehicle in the <code class="docutils literal notranslate"><span class="pre">--connect</span></code> parameter.</p>
<p>For example, to connect to SITL running on UDP port 14550 on your local computer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python simple_goto.py --connect <span class="m">127</span>.0.0.1:14550
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<div class="section" id="getting-the-points">
<h3>Getting the points<a class="headerlink" href="#getting-the-points" title="Permalink to this headline">¶</a></h3>
<p>The example parses the <strong>flight.tlog</strong> file for position information. First we read all the points.
We then keep the first 99 points that are at least 3 metres separated from the preceding kept point.</p>
<p>For safety reasons, the altitude for the waypoints is set to 30 meters (irrespective of the recorded height).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">position_messages_from_tlog</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given telemetry log, get a series of wpts approximating the previous flight</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pull out just the global position msgs</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mlog</span> <span class="o">=</span> <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink_connection</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">.</span><span class="n">recv_match</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GLOBAL_POSITION_INT&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1"># ignore we get where there is no fix:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">lat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Shrink the number of points for readability and to stay within autopilot memory limits.</span>
    <span class="c1"># For coding simplicity we:</span>
    <span class="c1">#   - only keep points that are with 3 metres of the previous kept point.</span>
    <span class="c1">#   - only keep the first 100 points that meet the above criteria.</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="n">keep_point_distance</span><span class="o">=</span><span class="mi">3</span> <span class="c1">#metres</span>
    <span class="n">kept_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kept_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Keep the first message</span>
    <span class="n">pt1num</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">pt2num</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1">#Keep the last point. Only record 99 points.</span>
        <span class="k">if</span> <span class="n">pt2num</span><span class="o">==</span><span class="n">num_points</span><span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">kept_messages</span><span class="p">)</span><span class="o">==</span><span class="mi">99</span><span class="p">:</span>
            <span class="n">kept_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">])</span>
            <span class="k">break</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">LocationGlobalRelative</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt1num</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="n">messages</span><span class="p">[</span><span class="n">pt1num</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="n">LocationGlobalRelative</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">distance_between_points</span> <span class="o">=</span> <span class="n">get_distance_metres</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distance_between_points</span> <span class="o">&gt;</span> <span class="n">keep_point_distance</span><span class="p">:</span>
            <span class="n">kept_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">])</span>
            <span class="n">pt1num</span><span class="o">=</span><span class="n">pt2num</span>
        <span class="n">pt2num</span><span class="o">=</span><span class="n">pt2num</span><span class="o">+</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">kept_messages</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-the-new-waypoints">
<h3>Setting the new waypoints<a class="headerlink" href="#setting-the-new-waypoints" title="Permalink to this headline">¶</a></h3>
<p>The following code shows how the vehicle writes the received messages as commands (this part of the code is very similar to that
shown in <a class="reference internal" href="mission_basic.html#example-mission-basic"><span class="std std-ref">Example: Basic Mission</span></a>):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Generating </span><span class="si">%s</span><span class="s2"> waypoints from replay...&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
<span class="n">cmds</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)):</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="c1"># To prevent accidents we don&#39;t trust the altitude in the original flight, instead</span>
    <span class="c1"># we just put in a conservative cruising altitude.</span>
    <span class="n">altitude</span> <span class="o">=</span> <span class="mf">30.0</span> <span class="c1"># pt[&#39;alt&#39;]</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">,</span>
                   <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT</span><span class="p">,</span>
                   <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_NAV_WAYPOINT</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">altitude</span><span class="p">)</span>
    <span class="n">cmds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="c1">#Upload clear message and command messages to vehicle.</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="known-issues">
<h2>Known issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<p>There are no known issues with this example.</p>
</div>
<div class="section" id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>The full source code at documentation build-time is listed below (<a class="reference external" href="https://github.com/dronekit/dronekit-python/blob/master/examples/flight_replay/flight_replay.py">current version on github</a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">© Copyright 2015-2016, 3D Robotics.</span>
<span class="sd">flight_replay.py: </span>

<span class="sd">This example requests a past flight from Droneshare, and then &#39;replays&#39; </span>
<span class="sd">the flight by sending waypoints to a vehicle.</span>

<span class="sd">Full documentation is provided at http://python.dronekit.io/examples/flight_replay.html</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">dronekit</span> <span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="n">VehicleMode</span><span class="p">,</span> <span class="n">LocationGlobalRelative</span>
<span class="kn">from</span> <span class="nn">pymavlink</span> <span class="kn">import</span> <span class="n">mavutil</span>
<span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#Set up option parsing to get connection string</span>
<span class="kn">import</span> <span class="nn">argparse</span>  
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Load a telemetry log and use position data to create mission waypoints for a vehicle. Connects to SITL on local PC by default.&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--connect&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;vehicle connection target.&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tlog&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;flight.tlog&#39;</span><span class="p">,</span>
                   <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Telemetry log containing path to replay&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_distance_metres</span><span class="p">(</span><span class="n">aLocation1</span><span class="p">,</span> <span class="n">aLocation2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the ground distance in metres between two LocationGlobal objects.</span>

<span class="sd">    This method is an approximation, and will not be accurate over large distances and close to the </span>
<span class="sd">    earth&#39;s poles. It comes from the ArduPilot test code: </span>
<span class="sd">    https://github.com/diydrones/ardupilot/blob/master/Tools/autotest/common.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">aLocation2</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">aLocation1</span><span class="o">.</span><span class="n">lat</span>
    <span class="n">dlong</span> <span class="o">=</span> <span class="n">aLocation2</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">aLocation1</span><span class="o">.</span><span class="n">lon</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dlat</span><span class="o">*</span><span class="n">dlat</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dlong</span><span class="o">*</span><span class="n">dlong</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.113195e5</span>



<span class="k">def</span> <span class="nf">distance_to_current_waypoint</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets distance in metres to the current waypoint. </span>
<span class="sd">    It returns None for the first waypoint (Home location).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nextwaypoint</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">next</span>
    <span class="k">if</span> <span class="n">nextwaypoint</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">missionitem</span><span class="o">=</span><span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">nextwaypoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#commands are zero indexed</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">missionitem</span><span class="o">.</span><span class="n">x</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">missionitem</span><span class="o">.</span><span class="n">y</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">missionitem</span><span class="o">.</span><span class="n">z</span>
    <span class="n">targetWaypointLocation</span> <span class="o">=</span> <span class="n">LocationGlobalRelative</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">alt</span><span class="p">)</span>
    <span class="n">distancetopoint</span> <span class="o">=</span> <span class="n">get_distance_metres</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">global_frame</span><span class="p">,</span> <span class="n">targetWaypointLocation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">distancetopoint</span>

<span class="k">def</span> <span class="nf">position_messages_from_tlog</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given telemetry log, get a series of wpts approximating the previous flight</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pull out just the global position msgs</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mlog</span> <span class="o">=</span> <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink_connection</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mlog</span><span class="o">.</span><span class="n">recv_match</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GLOBAL_POSITION_INT&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1"># ignore we get where there is no fix:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">lat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Shrink the number of points for readability and to stay within autopilot memory limits. </span>
    <span class="c1"># For coding simplicity we:</span>
    <span class="c1">#   - only keep points that are with 3 metres of the previous kept point.</span>
    <span class="c1">#   - only keep the first 100 points that meet the above criteria.</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="n">keep_point_distance</span><span class="o">=</span><span class="mi">3</span> <span class="c1">#metres</span>
    <span class="n">kept_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kept_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Keep the first message</span>
    <span class="n">pt1num</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">pt2num</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1">#Keep the last point. Only record 99 points.</span>
        <span class="k">if</span> <span class="n">pt2num</span><span class="o">==</span><span class="n">num_points</span><span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">kept_messages</span><span class="p">)</span><span class="o">==</span><span class="mi">99</span><span class="p">:</span>
            <span class="n">kept_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">])</span>
            <span class="k">break</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">LocationGlobalRelative</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt1num</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="n">messages</span><span class="p">[</span><span class="n">pt1num</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="n">LocationGlobalRelative</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">distance_between_points</span> <span class="o">=</span> <span class="n">get_distance_metres</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distance_between_points</span> <span class="o">&gt;</span> <span class="n">keep_point_distance</span><span class="p">:</span>
            <span class="n">kept_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">pt2num</span><span class="p">])</span>
            <span class="n">pt1num</span><span class="o">=</span><span class="n">pt2num</span>
        <span class="n">pt2num</span><span class="o">=</span><span class="n">pt2num</span><span class="o">+</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">kept_messages</span>
    
    
<span class="k">def</span> <span class="nf">arm_and_takeoff</span><span class="p">(</span><span class="n">aTargetAltitude</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arms vehicle and fly to aTargetAltitude.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Don&#39;t try to arm until autopilot is ready</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">is_armable</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Waiting for vehicle to initialise...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="c1"># Set mode to GUIDED for arming and takeoff:</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;GUIDED&quot;</span><span class="p">):</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;GUIDED&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="c1"># Confirm vehicle armed before attempting to take off</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Waiting for arming...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Taking off!&quot;</span><span class="p">)</span>
    <span class="n">vehicle</span><span class="o">.</span><span class="n">simple_takeoff</span><span class="p">(</span><span class="n">aTargetAltitude</span><span class="p">)</span> <span class="c1"># Take off to target altitude</span>

    <span class="c1"># Wait until the vehicle reaches a safe height </span>
    <span class="c1"># before allowing next command to process.</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">requiredAlt</span> <span class="o">=</span> <span class="n">aTargetAltitude</span><span class="o">*</span><span class="mf">0.95</span>
        <span class="c1">#Break and return from function just below target altitude.        </span>
        <span class="k">if</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">global_relative_frame</span><span class="o">.</span><span class="n">alt</span><span class="o">&gt;=</span><span class="n">requiredAlt</span><span class="p">:</span> 
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Reached target altitude of ~</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aTargetAltitude</span><span class="p">))</span>
            <span class="k">break</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Altitude: </span><span class="si">%f</span><span class="s2"> &lt; </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">global_relative_frame</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                                      <span class="n">requiredAlt</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Generating waypoints from tlog...&quot;</span><span class="p">)</span>
<span class="n">messages</span> <span class="o">=</span> <span class="n">position_messages_from_tlog</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tlog</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot; Generated </span><span class="si">%d</span><span class="s2"> waypoints from tlog&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">))</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No position messages found in log&quot;</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#Start SITL if no connection string specified</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">connect</span><span class="p">:</span>
    <span class="n">connection_string</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">connect</span>
    <span class="n">sitl</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">start_lat</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span><span class="o">/</span><span class="mf">1.0e7</span>
    <span class="n">start_lon</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span><span class="o">/</span><span class="mf">1.0e7</span>

    <span class="kn">import</span> <span class="nn">dronekit_sitl</span>
    <span class="n">sitl</span> <span class="o">=</span> <span class="n">dronekit_sitl</span><span class="o">.</span><span class="n">start_default</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">start_lat</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="n">start_lon</span><span class="p">)</span>
    <span class="n">connection_string</span> <span class="o">=</span> <span class="n">sitl</span><span class="o">.</span><span class="n">connection_string</span><span class="p">()</span>

<span class="c1"># Connect to the Vehicle</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Connecting to vehicle on: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">connection_string</span><span class="p">)</span>
<span class="n">vehicle</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">,</span> <span class="n">wait_ready</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="c1"># Now download the vehicle waypoints</span>
<span class="n">cmds</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">wait_ready</span><span class="p">()</span>


<span class="n">cmds</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
    <span class="c1">#print &quot;Point: %d %d&quot; % (pt.lat, pt.lon,)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">lat</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">lon</span>
    <span class="c1"># To prevent accidents we don&#39;t trust the altitude in the original flight, instead</span>
    <span class="c1"># we just put in a conservative cruising altitude.</span>
    <span class="n">altitude</span> <span class="o">=</span> <span class="mf">30.0</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">,</span>
                   <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT</span><span class="p">,</span>
                   <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_NAV_WAYPOINT</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">lat</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span> <span class="n">lon</span><span class="o">/</span><span class="mf">1.0e7</span><span class="p">,</span> <span class="n">altitude</span><span class="p">)</span>
    <span class="n">cmds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

<span class="c1">#Upload clear message and command messages to vehicle.</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Uploading </span><span class="si">%d</span><span class="s2"> waypoints to vehicle...&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">))</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Arm and Takeoff&quot;</span><span class="p">)</span>
<span class="n">arm_and_takeoff</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Starting mission&quot;</span><span class="p">)</span>

<span class="c1"># Reset mission set to first (0) waypoint</span>
<span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">next</span><span class="o">=</span><span class="mi">0</span>

<span class="c1"># Set mode to AUTO to start mission:</span>
<span class="k">while</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;AUTO&quot;</span><span class="p">):</span>
    <span class="n">vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;AUTO&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Monitor mission for 60 seconds then RTL and quit:</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_start</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
    <span class="n">nextwaypoint</span><span class="o">=</span><span class="n">vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">next</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Distance to waypoint (</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nextwaypoint</span><span class="p">,</span> <span class="n">distance_to_current_waypoint</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">nextwaypoint</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Exit &#39;standard&#39; mission when start heading to final waypoint&quot;</span><span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Return to launch&#39;</span><span class="p">)</span>
<span class="k">while</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;RTL&quot;</span><span class="p">):</span>
    <span class="n">vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;RTL&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1">#Close vehicle object before exiting script</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Close vehicle object&quot;</span><span class="p">)</span>
<span class="n">vehicle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Shut down simulator if it was started.</span>
<span class="k">if</span> <span class="n">sitl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">sitl</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Completed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


					<footer id="footer">
						
	<div class="footer-buttons" role="navigation" aria-label="footer navigation">
		
			<a href="channel_overrides.html" class="btn btn-default pull-right" title="Example: Channels and Channel Overrides">
				Next <span class="fa fa-arrow-circle-right"></span>
			</a>
		
		
			<a href="drone_delivery.html" class="btn btn-default" title="Example: Drone Delivery">
				<span class="fa fa-arrow-circle-left"></span> Previous
			</a>
		
	</div>


<hr/>

<div role="contentinfo">
	<p>
				&copy; Copyright 2015-2016, 3D Robotics.
	</p>
</div>
Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/3drobotics/sphinx_3dr_theme">theme</a> provided by <a href="https://3drobotics.com/">3D Robotics</a> for <a href="http://dronekit.io/">DroneKit</a>.
					</footer>
				</div>
			</div>
		</div>
	</div>

	
		<script type="text/javascript" src="../_static/js/jquery.js"></script>
		<script type="text/javascript" src="../_static/js/scroll.js"></script>
		<script type="text/javascript" src="../_static/underscore.js"></script>
		<script type="text/javascript" src="../_static/doctools.js"></script>
		<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
		<script type="text/javascript" src="../_static/js/cool-select.js"></script>
		<script type="text/javascript" src="../_static/searchtools.js"></script>
	
	<script type="text/javascript">
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','../../../../www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-39974306-3', 'auto');
		ga('send', 'pageview');
	</script>
</body>

<!-- Mirrored from dronekit-python.readthedocs.io/en/latest/examples/flight_replay.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 14:26:47 GMT -->
</html>